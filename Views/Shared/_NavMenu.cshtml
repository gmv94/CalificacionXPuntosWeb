@{
    var estaAutenticado = !string.IsNullOrEmpty(Context.Session.GetString("usuarioId"));
    var esSuperAdmin = Context.Session.GetString("rol") == "SuperAdmin";
    var nombreUsuario = Context.Session.GetString("nombreUsuario") ?? string.Empty;
}

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img src="~/img/Logo.png" alt="Logo" style="height: 35px; max-height: 35px;" />
        </a>
        <button title="Navigation menu" class="navbar-toggler" type="button" onclick="toggleNavMenu()" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="nav-scrollable collapse" id="navMenu">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <a class="nav-link @(Context.Request.Path == "/" || Context.Request.Path == "/Home" || Context.Request.Path == "/Home/Index" ? "active" : "")" href="/">
                <span aria-hidden="true"></span> Inicio
            </a>
        </div>
        <div class="nav-item px-3">
            <a class="nav-link @(Context.Request.Path.Value?.Contains("/ConsultarDocumento") == true ? "active" : "")" href="/Home/ConsultarDocumento">
                <span aria-hidden="true"></span> Consultar Documento
            </a>
        </div>
        @if (estaAutenticado)
        {
            @if (esSuperAdmin)
            {
                <div class="nav-item px-3">
                    <a class="nav-link @(Context.Request.Path.Value?.Contains("/Calificacion") == true ? "active" : "")" href="/Home/Calificacion">
                        <span aria-hidden="true"></span> Calificación
                    </a>
                </div>
            }
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/ListadoCalificaciones") == true ? "active" : "")" href="/Home/ListadoCalificaciones">
                    <span aria-hidden="true"></span> Listado Calificaciones
                </a>
            </div>
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/PuntosAcumulados") == true ? "active" : "")" href="/Home/PuntosAcumulados">
                    <span aria-hidden="true"></span> Puntos Acumulados
                </a>
            </div>
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/RedencionPuntos") == true ? "active" : "")" href="/Home/RedencionPuntos">
                    <span aria-hidden="true"></span> Redención Puntos
                </a>
            </div>
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/ListadoRedimidos") == true ? "active" : "")" href="/Home/ListadoRedimidos">
                    <span aria-hidden="true"></span> Listado Redimidos
                </a>
            </div>
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/TablaPremios") == true ? "active" : "")" href="/Home/TablaPremios">
                    <span aria-hidden="true"></span> Tabla Premios
                </a>
            </div>
            @if (esSuperAdmin)
            {
                <div class="nav-item px-3">
                    <a class="nav-link @(Context.Request.Path.Value?.Contains("/Administracion") == true ? "active" : "")" href="/Home/Administracion">
                        <span aria-hidden="true"></span> Administración
                    </a>
                </div>
            }
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/ActualizarContrasena") == true ? "active" : "")" href="/Home/ActualizarContrasena">
                    <span aria-hidden="true"></span> Cambiar Contraseña
                </a>
            </div>
            @if (esSuperAdmin)
            {
                <div class="nav-item px-3">
                    <a class="nav-link @(Context.Request.Path.Value?.Contains("/Registro") == true ? "active" : "")" href="/Home/Registro">
                        <span aria-hidden="true"></span> Registrar Usuario
                    </a>
                </div>
            }
            <div class="nav-item px-3">
                <a class="nav-link" href="/Login/Logout">
                    <span aria-hidden="true"></span> Cerrar Sesión (@nombreUsuario)
                </a>
            </div>
        }
        else
        {
            <div class="nav-item px-3">
                <a class="nav-link @(Context.Request.Path.Value?.Contains("/Login") == true ? "active" : "")" href="/Login">
                    <span aria-hidden="true"></span> Iniciar Sesión
                </a>
            </div>
        }
    </nav>
</div>

<script>
    function toggleNavMenu() {
        const navMenu = document.getElementById('navMenu');
        const button = document.querySelector('.navbar-toggler');
        if (navMenu) {
            const isCollapsed = navMenu.classList.contains('collapse');
            if (isCollapsed) {
                navMenu.classList.remove('collapse');
                if (button) {
                    button.setAttribute('aria-expanded', 'true');
                }
            } else {
                navMenu.classList.add('collapse');
                if (button) {
                    button.setAttribute('aria-expanded', 'false');
                }
            }
        }
    }

    function collapseNavMenu() {
        const navMenu = document.getElementById('navMenu');
        const button = document.querySelector('.navbar-toggler');
        if (navMenu) {
            navMenu.classList.add('collapse');
            if (button) {
                button.setAttribute('aria-expanded', 'false');
            }
        }
    }

    // Cerrar menú al hacer clic fuera o en un enlace (solo en móvil)
    document.addEventListener('DOMContentLoaded', function() {
        const navMenu = document.getElementById('navMenu');
        
        // En escritorio, asegurar que el menú esté visible
        if (window.innerWidth > 768) {
            if (navMenu) {
                navMenu.classList.remove('collapse');
            }
        } else {
            // En móvil, asegurar que el menú esté oculto
            if (navMenu) {
                navMenu.classList.add('collapse');
            }
        }

        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    collapseNavMenu();
                }
            });
        });

        // Manejar cambios de tamaño de ventana
        window.addEventListener('resize', function() {
            if (navMenu) {
                if (window.innerWidth > 768) {
                    navMenu.classList.remove('collapse');
                } else {
                    navMenu.classList.add('collapse');
                }
            }
        });
    });
</script>

